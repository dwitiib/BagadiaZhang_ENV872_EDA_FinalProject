---
title: "Data Wrangling-Air Quality"
author: "Dwiti Bagadia and Yue Zhang"
date: "2023-04-18"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include = FALSE}
#This code chunk will tidy your knit PDF files, wrapping long code lines
#For it to work, the "formatR" package needs to be installed
#install.packages('formatR')
knitr::opts_chunk$set(tidy.opts=list(width.cutoff=40), tidy=TRUE)

```

## OVERVIEW

This R Markdown file aims to wrangle the data of New York State air quality by county from 2018 to 2020.

## Set working directory and load packages
```{r packages, message = FALSE}
setwd("E:/MCRP/Spring2023/BagadiaZhang_ENV872_EDA_FinalProject")
getwd()
library(tidyverse)
library(lubridate)
library(dplyr)
```

## Load data and set working directory
```{r data, message = FALSE}
US_AQ_2018 = read.csv("./Data/RawData/annual_aqi_by_county_2018.csv")
US_AQ_2019 = read.csv("./Data/RawData/annual_aqi_by_county_2019.csv")
US_AQ_2020 = read.csv("./Data/RawData/annual_aqi_by_county_2020.csv")

```

## Select NY data
```{r NY data, message = FALSE}
NY_AQ_2018 = subset(US_AQ_2018, State == "New York")
NY_AQ_2019 = subset(US_AQ_2019, State == "New York")
NY_AQ_2020 = subset(US_AQ_2020, State == "New York")

```

## Clean NY data and calculate days with bad air quality
```{r clean NY data, message = FALSE}
NY_AQ_2018_clean = NY_AQ_2018 %>% 
  mutate("BadDays" = Days.with.AQI - Good.Days) %>% 
  select(County, Days.with.AQI, BadDays)
colnames(NY_AQ_2018_clean) = c("County", "Days18", "BadDays18")
NY_AQ_2019_clean = NY_AQ_2019 %>% 
  mutate("BadDays" = Days.with.AQI - Good.Days) %>% 
  select(County, Days.with.AQI, BadDays)
colnames(NY_AQ_2019_clean) = c("County", "Days19", "BadDays19")
NY_AQ_2020_clean = NY_AQ_2020 %>% 
  mutate("BadDays" = Days.with.AQI - Good.Days) %>% 
  select(County, Days.with.AQI, BadDays)
colnames(NY_AQ_2020_clean) = c("County", "Days20", "BadDays20")

```

## Join the NYC datasets
```{r Join, message = FALSE}
NY_AQ_join = merge(NY_AQ_2018_clean, NY_AQ_2019_clean, by = "County") %>% 
  merge(NY_AQ_2020_clean, by = "County")

```

## Calculate the mean bad days from 2018 to 2020
```{r clean NYC data, message = FALSE}
NY_AQ_join_clean = NY_AQ_join %>% mutate("BadDaysRate" = as.numeric(BadDays18 + BadDays19 + BadDays20)*100/as.numeric(Days18 + Days19 + Days20)) %>% select(County, BadDaysRate)

```

## Save NYC AQ data
```{r save data, message = FALSE}
write.csv(NY_AQ_join_clean, "./Data/ProcessedData/NY_AQ_processed1.csv", row.names = FALSE)

```